define("banjiajia/web/1.0.0/scripts/order/order/list",["$","pager","state","ace-elements","jggrid","gridlocale","validation","form","util","plugin"],function(a){function b(a){if(a){var b="";for(var d in a.data)b+=c(a.data[d]);h("#dataTotal").text("共检索出"+a.page.count+"条数据"),q.html(b),r=a.page.length;var j={totalPages:a.page.total,currentPage:a.page.current,callback:e};i.init(h(".pagination"),j),h("tr.parent").css("cursor","pointer").attr("title","点击展开/关闭子订单").click(function(){var a=h(this);a.siblings(".child-"+this.id).toggle(),a.siblings(".btn-"+this.id).toggle()}),g(),f()}}function c(a){var b="";a.orderAddress.address;var c=a.ordersDetails;b+='<tr class=" parent" id="row'+a.order.orderNo+'" s=0>'+'<td class="center  sorting_1">'+"<label>"+'<input type="checkbox" class="ace">'+'<span class="lbl"></span>'+"</label>"+"</td>"+'<td class=" ">'+a.order.orderNo+"</td>"+'<td class="">'+a.order.title+"</td>"+'<td class=" ">'+a.order.userName+"</td>"+'<td class=" ">'+k.get(k.OrderProcessState(),a.order.orderState)+"</td>"+'<td class=" ">'+n.fmoney(a.order.dealPrice/100,2)+"</td>"+'<td class=" ">'+a.orderAddress.babysNames+"</td>"+'<td class=" ">'+a.orderAddress.badysBirthday+"</td>"+'<td class=" ">'+a.order.userId+"</td>"+'<td class=" ">'+a.orderAddress.phone+"</td>"+'<td class="" >'+'<div class="visible-md visible-lg hidden-sm hidden-xs action-buttons">'+'<a class="blue" target="_blank" href="'+_contentPath+"/order/detail/"+a.order.orderNo+'.html">'+'<i class="icon-zoom-in bigger-130"></i>'+"</a>"+"</div>"+"</td>"+"</tr>";var d=0;return h.each(c,function(e){var f=c[e],g=1===parseInt(f.orderState)&&200==parseInt(a.order.orderState)?!0:!1,h={title:f.title,state:l.get(l.OrderProcessState(),f.orderState),starTime:n.getLocalTime(f.startTime/1e3),endTime:n.getLocalTime(f.endTime/1e3),teacherName:f.teacherName,price:n.fmoney(f.orderUnitPrice/100,2),countPrice:n.fmoney(f.orderCountPrice/100,2),goodsCount:f.goodsCount,createTime:n.getLocalTime(f.createTime/1e3)};d=1===parseInt(f.orderState)?d+1:d,b+='<tr class="warning child-row'+a.order.orderNo+'" style="display:none">'+'<td class="center  sorting_1">'+"<label>"+(g?'<input type="checkbox" name="refundChk'+a.order.orderNo+'" data-detail='+f.orderDetailNo+" data-title="+h.title+" data-state="+h.state+' data-start="'+h.starTime+'" data-end="'+h.endTime+'" data-teacherName='+h.teacherName+" data-create="+h.createTime+" data-price="+h.price+" data-countPrice="+h.countPrice+" data-goodsCount="+h.goodsCount+">":"")+'<span class="lbl"></span>'+"</label>"+"</td>"+'<td class="">'+f.orderDetailNo+"</td>"+'<td class="">'+f.title+"</td>"+'<td class="">'+f.teacherName+"</td>"+'<td class="">'+l.get(l.OrderProcessState(),f.orderState)+"</td>"+'<td class="">'+n.fmoney(f.unitPirce/100,2)+"/"+n.fmoney(f.countPrice/100,2)+"</td>"+'<td class="">'+f.goodsCount+"</td>"+'<td class="">'+n.getLocalTime(f.startTime/1e3)+"</td>"+'<td class="">'+n.getLocalTime(f.endTime/1e3)+"</td>"+'<td class="">'+n.getLocalTime(f.createTime/1e3)+"</td>"+'<td class="">'+(g?"可退款":"不可退款")+"</td>"+"</tr>"}),200==parseInt(a.order.orderState)&&d>=1&&(b+='<tr class="btn-row'+a.order.orderNo+'" style="display:none">'+'<td class="" colspan="11">'+'<button class="btn btn-large btn-block btn-primary Refund" id="Refund" type="button" data-order="'+a.order.orderNo+'">退款</button></td></tr>'),b}function d(){h("#serchBtn").click(function(){var a=h(this).attr("data-fild");t=new Array,t.push(a+"="+encodeURI(encodeURI(h("#searchValue").val()))),t.push("orderState="+h("#stateDropDown").attr("data-chk")),e(null,null,null,1)})}function e(a,c,d,e){var f=(parseInt(e)-1)*r;h.ajax({url:_contentPath+"/order/list/query.json?begin="+f+"&"+t.join("&"),async:!0,dataType:"json",success:function(a){o=e+1,b(a.orderViews)},error:function(a,b,c){console.log("error="+c)}})}function f(){h(".refundExecBtn").unbind("click").click(function(){s&&h(this).parent().prev("div").children("form").ajaxSubmit({beforeSubmit:function(){s=!1},complete:function(){s=!0,h("#myModal").modal("hide")},success:function(a){var a=n.JsonEval(a);if(a){var b=a.result;b&&1==b.state?e(null,null,null,o):alert("退款失败")}else alert("退款失败")}})})}function g(){h(".Refund").unbind("click").click(function(){var a=h(this).attr("data-order"),b=new Array,c="",d=0;h("input:checkbox[name=refundChk"+a+"]").each(function(){return h(this).is(":checked")&&d++,0==d?(alert("请至少选择一个订单"),void 0):(b.push(h(this).attr("data-detail")),c+="<tr><td>"+h(this).attr("data-detail")+"</td>"+"<td>"+h(this).attr("data-state")+"</td>"+"<td>"+h(this).attr("data-price")+"</td>"+"<td>"+h(this).attr("data-goodsCount")+"</td>"+"<td>"+h(this).attr("data-countPrice")+"</td></tr>",void 0)}),d>0&&(h("#refoundtbody").html(c),h.ajax({url:_contentPath+"/order/refund/detail.json?orderNo="+a+"&detailNos="+b.join(","),async:!0,dataType:"json",success:function(c){if(c){var d=c.result;d&&1==d.state?(h("#modalOrderNo").val(a),h("#modalOrderDetailNos").val(b.join(",")),h("#modalRefundPrice").val(n.fmoney(parseInt(d.content)/100,2)),h("#myModal").modal("show")):alert("退款状态异常!")}},error:function(a,b,c){console.log("error="+c)}}))})}var h=a("$"),i=a("pager"),j=a("state");a("ace-elements"),a("jggrid"),a("gridlocale"),a("validation")(h),a("ace-elements"),a("form")(h);var k=new j;k.init(_contentPath+"/system/config/get/order_state.json");var l=new j;l.init(_contentPath+"/system/config/get/order_detail_state.json");var m=a("util"),n=new m,o=1,p=a("plugin"),q=h("#theacertbody"),r=0,s=!0,t=new Array,u={init:function(){n.ajaxGlobalSetting(),e(null,null,null,0),d();var a=(new p).bootstrap();a.dropdownInIt(),a.dropDownAlone()}};u.init()});
