define("banjiajia/web/1.0.0/scripts/members/teacher/edit",["$","ace-elements","validation","map"],function(require,exports,module){function shoppingDistrictsAdd(a){for(var b=a,c=0;c<b.length;c++){var d=b[c];shopDistrictMap.put(d,"")}b.length>0&&setshoppingDistrictsSelect()}function removeDistrictsSelect(a){var b=$(a).parents("span");b.remove(),shopDistrictMap.remove(b.attr("val")),setshoppingDistrictsSelect()}function setshoppingDistrictsSelect(){var a="",b="";shopDistrictMap.each(function(c){a+=c+",",b+='<span val="'+c+'" class="tag">'+c+'<button type="button" class="close">×</button></span>'}),a.length>0&&(a=a.substring(0,a.length-1)),$("#shoppingDistrictId").val(a),$("#shoppingDistrictsSelectTags").html(b),$("#shoppingDistrictsSelectTags button").bind("click",function(){removeDistrictsSelect(this)})}function shoppingDistrictsRemove(a){shopDistrictMap.remove(a)}function chose_mult_set_ini(a,b){for(var c=b.split(","),d=c.length,e="",f=0;d>f;f++)e=c[f],$(a+" option[value='"+e+"']").attr("selected","selected");$(a).trigger("chosen:updated")}function allSelectEvent(){for(var a=0;a<nowDistricts.length;a++){var b=nowDistricts[a].name;shopDistrictMap.put(b,"")}setshoppingDistrictsSelect()}var $=require("$");require("ace-elements"),require("validation")($);var Map=require("map"),shopDistrictMap=new Map,localMap=new Map,newTeacherForm=$("#newTeacherForm"),newTeacherButton=$("#newTeacherButton"),phoneInput=$("#phoneInput"),queryKey=$("#queryKey"),allSelectButton=$("#allSelectButton"),nowDistricts=null,initTempSelect=$("#shoppingDistrictId").val().split(",");shoppingDistrictsAdd(initTempSelect),$(".chosen-select").chosen(),$("#form-field-select-4").addClass("tag-input-style"),$("#shoppingDistrictsSelect").addClass("tag-input-style"),$("#courseTypeSelectId").addClass("tag-input-style"),chose_mult_set_ini("#form-field-select-4",$("#teacherSkills").val()),chose_mult_set_ini("#courseTypeSelectId",$("#courseTypeId").val()),$(".search-field input").height(25),$(".date-picker").datepicker({autoclose:!0}).next().on(ace.click_event,function(){$(this).prev().focus()});var J=$;$("#avatarUpload").dropzone({url:_contentPath+"/common/resource/image/upload.json",maxFiles:10,maxFilesize:3,previewsContainer:!1,init:function(){this.on("success",function(file,data){var image=eval("("+data+")");console.log("File "+image.image.url+"uploaded"),J("#avatarInput").val(image.image.url),J("#avatarUpload").attr("src",image.image.url)}),this.on("removedfile",function(a){console.log("File "+a.name+"removed")})}});var func={init:function(){var a=this;newTeacherForm.validation(function(a,b){"queryKey"==a.id&&J.post(_contentPath+"/members/teacher/check/phone/"+queryKey.val()+".json",null,function(a){b.err=1==a.result?!1:!0,b.err?(0==a.result&&(b.msg="老师已经存在"),-1==a.result&&(b.msg="用户不存在请先注册"),phoneInput.val("")):phoneInput.val(queryKey.val())},"json")},{reqmark:!1}),newTeacherButton.bind("click",function(b){a.teacherButtonClick(b)})},teacherButtonClick:function(){return 0==newTeacherForm.valid(this,"error!")?!1:(J("#teacherSkills").val(J("#form-field-select-4").val()),J("#courseTypeId").val(J("#courseTypeSelectId").val()),newTeacherForm.submit(),void 0)}},araeself=this,arae={provinces:null,nowProvince:null,nowCities:null,provinceMap:null,nowCity:null,nowDistricts:null,init:function(a){araeself=this,provinces=a.locationArae,araeself.initMap(),araeself.bindProvinceDate(),allSelectButton.bind("click",function(){allSelectEvent()})},initMap:function(){for(var a=localMap,b=0;b<provinces.length;b++){var c=provinces[b].np.pn;a.put(c,provinces[b]);for(var d=provinces[b].cs,e=0;e<d.length;e++){var f=d[e].nc.cn;a.put(f,d[e])}}provinceMap=a},initOldSelect:function(){},bindProvinceDate:function(){var a=$("#province"),b=a.val();a.html("");for(var c="",d=0;d<provinces.length;d++){var e=provinces[d];c+=' <option val="'+e.np.p+'" value="'+e.np.pn+'">'+e.np.pn+"</option>"}a.html(c),a.bind("change",function(){araeself.provinceOnChange()}),nowProvince=provinceMap.get(b),a.val(b),araeself.bindCityData()},provinceOnChange:function(){for(var a=$("#province"),b=a.val(),c=0;c<provinces.length;c++){var d=provinces[c].np.pn;if(d==b){nowProvince=provinces[c],araeself.bindCityData();break}}},bindCityData:function(){var a=$("#city"),b=$("#city").val();a.html(""),nowCities=nowProvince.cs;for(var c=nowCities,d="",e=0;e<c.length;e++){var f=c[e];d+=' <option val="'+f.nc.c+'" value="'+f.nc.cn+'">'+f.nc.cn+"</option>"}a.html(d),a.bind("change",function(){araeself.cityOnChange()}),nowCity=provinceMap.get(b),araeself.bindDistrictData()},cityOnChange:function(){for(var a=$("#city"),b=a.val(),c=0;c<nowCities.length;c++){var d=nowCities[c].nc.cn;if(d==b){nowCity=nowCities[c],araeself.bindDistrictData();break}}},bindDistrictData:function(){var a=$("#district"),b=$("#district").val();a.html("");for(var c=nowCity.as,d="",e=0;e<c.length;e++){var f=c[e];d+=' <option val="'+f.a+'"  value="'+f.an+'">'+f.an+"</option>"}a.html(d),a.val(b),araeself.districtOnChange(),a.unbind()},districtOnChange:function(){}},areaDistrict={provinces:null,nowProvince:null,nowCities:null,nowCity:null,nowDistricts:null,init:function(a){areaself=this,provinces=a.locationArae,areaself.bindProvinceDate()},initOldSelect:function(){},bindProvinceDate:function(){var a=$("#sprovince");a.html("");for(var b="",c=0;c<provinces.length;c++){var d=provinces[c];b+=' <option value="'+d.np.p+'">'+d.np.pn+"</option>"}a.html(b),a.bind("change",function(){areaself.provinceOnChange()})},provinceOnChange:function(){for(var a=$("#sprovince"),b=a.val(),c=0;c<provinces.length;c++){var d=provinces[c].np.p;if(d==b){nowProvince=provinces[c],areaself.bindCityData();break}}},bindCityData:function(){var a=$("#scity");a.html(""),nowCities=nowProvince.cs;for(var b=nowCities,c="",d=0;d<b.length;d++){var e=b[d];c+=' <option value="'+e.nc.c+'">'+e.nc.cn+"</option>"}a.html(c),a.bind("change",function(){areaself.cityOnChange()}),nowCity=nowCities[0],areaself.bindDistrictData()},cityOnChange:function(){for(var a=$("#scity"),b=a.val(),c=0;c<nowCities.length;c++){var d=nowCities[c].nc.c;if(d==b){nowCity=nowCities[c],areaself.bindDistrictData();break}}},bindDistrictData:function(){var a=$("#sdistrict");a.html("");for(var b=nowCity.as,c="",d=0;d<b.length;d++){var e=b[d];c+=' <option value="'+e.an+'">'+e.an+"</option>"}a.html(c),a.unbind(),areaself.districtOnChange(),a.bind("change",function(){areaself.districtOnChange()})},districtOnChange:function(){$.ajax({url:_contentPath+"/common/resource/district/list.json?&area="+$("#sdistrict").val()+"&"+(new Date).getTime(),async:!0,dataType:"json",success:function(a){_marketId=$("#shoppingDistrictsSelect");var b="";nowDistricts=a.districts;for(var c=0;c<a.districts.length;c++){var d=a.districts[c];b+=' <option value="'+d.name+'">'+d.name+"</option>"}_marketId.html(b),$("#shoppingDistrictsSelect").trigger("chosen:updated"),$("#shoppingDistrictsSelect").change(function(){var a=$("#shoppingDistrictsSelect").val();shoppingDistrictsAdd(a)})},error:function(){}})}};$.ajax({url:_contentPath+"/resources/assets/sea-modules/gallery/common/locationarea.js",async:!0,dataType:"json",success:function(a){arae.init(a),areaDistrict.init(a)},error:function(){}}),func.init()});
