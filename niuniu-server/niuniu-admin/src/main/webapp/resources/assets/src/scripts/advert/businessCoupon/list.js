Date.prototype.Format = function (fmt) { //author: meizz     var o = {        "M+": this.getMonth() + 1, //月份         "d+": this.getDate(), //日         "H+": this.getHours(), //小时         "m+": this.getMinutes(), //分         "s+": this.getSeconds(), //秒         "q+": Math.floor((this.getMonth() + 3) / 3), //季度         "S": this.getMilliseconds() //毫秒     };    if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));    for (var k in o)    if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));    return fmt;}/* * product list  --douzy */define(function(require,exports,module){	var $=require("$"),Pager=require("pager"),Util=require("util"),State=require("state");	var util=new  Util();	util.ajaxGlobalSetting();	require("ace-elements");	require("jggrid");	require("gridlocale");	require("validation")($);	var plugin=require("plugin");	var Util=require("util");	var util=new Util();	var theacertbody = $("#theacertbody");	var pageSize=0;		$.fn.datetimepicker.dates['zh-CN'] = {			days: ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六", "星期日"],			daysShort: ["周日", "周一", "周二", "周三", "周四", "周五", "周六", "周日"],			daysMin:  ["日", "一", "二", "三", "四", "五", "六", "日"],			months: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],			monthsShort: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],			today: "今天",			suffix: [],			meridiem: ["上午", "下午"]	};		$('.date-picker').datetimepicker({language: 'zh-CN',todayBtn: 1,autoclose:true}).next().on(ace.click_event, function(){		$(this).prev().focus();	});		var parmasArr=new Array();	function  relaodDate(result){		var theacertbodyHtml="";		var i = 1;		for ( var teacher in result.data) {			theacertbodyHtml+=teacherTr(result.data[teacher], i);			i++;		}				theacertbody.html(theacertbodyHtml);		pageSize=result.page.length;		var option={				totalPages:result.page.total,				currentPage:result.page.current,				callback:fetchData			};		Pager.init($(".pagination"),option);				$("#avatarUpload").dropzone({	        url: _contentPath+'/common/resource/image/upload.json',	        maxFiles: 10,	        maxFilesize: 3,	        previewsContainer:false,	        init: function() {	            this.on("success", function(file,data) {	            	var image = eval('(' + data + ')');	            	var flag = image.success;	            	if(flag == false){	            		alert("图片过大，上传失败");	            		return;	            	};	                $("#picUrl").val(image.image.url);	                $("#avatarUpload").attr("src",image.image.url);	            });	            this.on("removedfile", function(file) {	                console.log("File " + file.name + "removed");	            });	        }	    });		$(".advertCon").click(function(){            var self=$(this);            var con=$(this).attr("data-content");            var $tbody=$("#refoundtbody");            $tbody.html("")            var html="";            var conArr=con.split(",");            for(var i=0;i<conArr.length;i++){                var con=conArr[i];                var html="";                if(con !== null || con !== undefined || con !== ''){                	 if(i == 0){                     	html+="<tr>";                        html+='<td><img width="100px"  height="180px"  class=" img-responsive"   src="'+con+'"></td>';                        html+='<td><a>修改</a></td>';                        html+="</tr>"                     }                }                $tbody.append(html);            }            $("#myModal").modal("show");        });        $(".examine").click(function(){            $("#examineId").val($(this).attr("data-id"));           /* var rowNum = $(this).attr("data-index");            var table = document.getElementById("sample-table-2");            var picUrl = table.rows[rowNum].cells[1].innerText;            if(picUrl != null && picUrl != undefined && picUrl != ''){            	$("#avatarUpload").attr("src",picUrl);            }else{            	$("#avatarUpload").attr("src","");            }            $("#picUrl").val(picUrl);            $("#secondLevelUrl").val(table.rows[rowNum].cells[2].innerText);*/            $("#examineModal").modal("show");        });        $(".btn-success").click(function(){            var examineId= parseInt($("#examineId").val());//            var picUrl = $("#picUrl").val();//            var secondLevelUrl = $("#secondLevelUrl").val();            var state = 1;            $.ajax({                url: _contentPath + '/businessCoupon/updateState.json?id=' + examineId + '&state='+ state,                async: true,                dataType: 'json',                success: function (data) {                    if(!!data) {                        $("#examineModal").modal("hide");                        alert(data.msg);                        location=location;                    }                },                error: function (jqXHR, textStatus, errorThrown) {                    console.log("error=" + errorThrown);                }            });        });        $(".btn-danger").click(function(){            var examineId= parseInt($("#examineId").val());            if(examineId>0) {            	var pass = $("#pass").val();            	/*if(pass == null || pass == undefined || pass == ''){            		alert("请说明审核失败原因!");            		return;            	}*/                $.ajax({                    url: _contentPath + '/businessCoupon/updateState.json?id=' + examineId + '&state=4',                    async: true,                    dataType: 'json',                    success: function (data) {                        if(!!data) {                            $("#examineModal").modal("hide");                            alert(data.msg);                            location=location;                        }                    },                    error: function (jqXHR, textStatus, errorThrown) {                        console.log("error=" + errorThrown);                    }                });            }        });	}		function teacherTr(data, i){		var html="";		        var couponType;        switch(data.couponType)        {        case 0:        	couponType = '现金券';          break;        case 1:        	couponType = '折扣券';          break;        case 2:        	couponType = '实物券';        	break;        default:        	couponType = "";        }                var status;        switch(data.state)        {        case 0:          state = '待审核';          break;        case 1:        	state = '审核通过';          break;        case 2:        	state = '暂停';        	break;        case 3:        	state = '已下线';        	break;        case 4:        	state = '未通过';        	break;        case 5:        	state = '超时完成';        	break;        default:        	state = "";        }        		html+='<tr class="odd">'+		'<td class=" ">'+((data.id != null && data.id != 0) ? data.id : "")+'</td>'+		'<td class=" ">'+couponType+'</td>'+		'<td class=" ">'+state+'</td>'+ 		'<td class=" ">'+(data.userId != null ? data.userId : "")+'</td>'+		'<td class=" ">'+(data.couponTitle != null ? data.couponTitle : "")+'</td>'+		'<td class=" ">'+(data.couponContent != null ? data.couponContent : "")+'</td>'+		'<td class=" ">'+(data.createTime != null ? data.createTime : "")+'</td>'+		'<td class=" ">'+(data.startDate != null ? data.startDate : "")+'</td>'+		'<td class=" ">'+(data.endDate != null ? data.endDate : "")+'</td>'+		'<td class=" ">'+(data.modifyTime != null ? data.modifyTime : "")+'</td>'+		'<td class=" ">'+(data.flag != null ? data.flag : "")+'</td>'+		'<td class=" ">'+(data.money != null ? data.money : "")+'</td>'+ 		'<td class=" ">'+(data.discount != null ? data.discount : "")+'</td>'+ 		'<td class=" ">'+(data.physicalVolume != null ? data.physicalVolume : "")+'</td>'+ 		'<td class=" ">'+			'<div class="visible-md visible-lg hidden-sm hidden-xs action-buttons">'+				'<a class="green examine" href="javascript:void(0);" data-id="'+					data.id + '"><i class="icon-pencil bigger-130"></i></a>'+			'</div>' + '</td>'+		'</tr>';		return html;	}		function initFunction(){				$("#serchBtn").click(function(){			var filed=$(this).attr("data-fild");			fetchData(null,null,null,1);		});				/*$("#exportBtn").click(function(){			var filed=$(this).attr("data-fild");			parmasArr=new Array();			parmasArr.push(filed+"="+encodeURI(encodeURI($("#searchValue").val())));			parmasArr.push("startTime="+$("#id-date-picker-3").val());			parmasArr.push("endTime="+$("#id-date-picker-4").val());			window.location = _contentPath + '/agent/promotion/export.json?' + parmasArr.join("&");		});*/			}		function enableTooltips(table) {		$('.navtable .ui-pg-button').tooltip({container:'body'});		$(table).find('.ui-pg-div').tooltip({container:'body'});	}	function fetchData(event, originalEvent, type,page){		var begin=(parseInt(page)-1)*pageSize;		var userId=$("#userId").val();		$.ajax({	        url: _contentPath+'/businessCoupon/selectBusinessCoupon.json?begin='+begin+("&")+'userId='+userId+parmasArr.join("&"),	        async: true,	        dataType: 'json',	        success: function(data){	        	relaodDate(data.businessCoupons);	        },	       	        error: function(jqXHR , textStatus , errorThrown){	        	console.log("error="+errorThrown);	        }		});	}	var func = {			init : function() {				fetchData(null,null,null,0);				initFunction();				var plugin_bootstrap=new plugin().bootstrap();				plugin_bootstrap.dropdownInIt();				plugin_bootstrap.dropDownAlone();			}		};			func.init();		});